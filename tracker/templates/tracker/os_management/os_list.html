{% extends "tracker/base.html" %}

{% block title %}Manage Operating Systems{% endblock %}

{% block content %}
<h2>Manage Operating Systems</h2>

<div class="mb-3">
    <a href="{% url 'tracker:os_create' %}" class="btn btn-primary">Add New Operating System</a>
</div>

{% if operating_systems %} {# Note: ListView context uses object_list by default, but we aliased it #}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Version</th>
                <th>Vendor</th>
                <th>EOL Date</th>
                <th>Supported?</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {# Use page_obj if pagination is active, otherwise stick to operating_systems #}
            {% for os in page_obj|default:operating_systems %}
            <tr>
                <td>{{ os.name }}</td>
                <td>{{ os.version|default:"-" }}</td>
                <td>{{ os.vendor|default:"-" }}</td>
                <td>{{ os.end_of_life_date|date:"Y-m-d"|default:"-" }}</td>
                <td>
                    {% if os.is_supported %}
                        <span class="badge bg-success">Yes</span>
                    {% else %}
                        <span class="badge bg-danger">No</span>
                    {% endif %}
                </td>
                <td class="action-buttons">
                    <a href="{% url 'tracker:os_update' os.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                    <form action="{% url 'tracker:os_delete' os.pk %}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete \'{{ os }}\'?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger ms-1">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# --- Add Pagination Controls --- #}
{% if is_paginated %} {# is_paginated is automatically passed by ListView #}
<nav aria-label="Operating Systems pagination" class="mt-4">
  <ul class="pagination justify-content-center">
    {# Previous Button #}
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link" aria-hidden="true">&laquo;</span>
      </li>
    {% endif %}

    {# Page Numbers #}
    {% for i in paginator.page_range %} {# Use paginator.page_range #}
      {% if page_obj.number == i %}
        <li class="page-item active" aria-current="page"><span class="page-link">{{ i }}</span></li>
      {% elif i > page_obj.number|add:'-3' and i < page_obj.number|add:'3' %}
         {# Show nearby pages #}
         <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
      {% elif i == 1 or i == paginator.num_pages %}
         {# Always show first and last page #}
          {% if i > page_obj.number|add:'3' and page_obj.number < paginator.num_pages|add:'-3' and i == paginator.num_pages %}
            <li class="page-item disabled"><span class="page-link">...</span></li> {# Ellipsis before last #}
          {% endif %}
           <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
           {% if i < page_obj.number|add:'-3' and page_obj.number > 4 and i == 1 %}
             <li class="page-item disabled"><span class="page-link">...</span></li> {# Ellipsis after first #}
           {% endif %}
      {% endif %}
    {% endfor %}

    {# Next Button #}
    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link" aria-hidden="true">&raquo;</span>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{# --- End Pagination --- #}


{% else %}
<p>No operating systems defined yet. <a href="{% url 'tracker:os_create' %}">Add the first one?</a></p>
{% endif %}

{% endblock %}
