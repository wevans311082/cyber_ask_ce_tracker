{% extends "tracker/base.html" %}

{% block title %}Assessor Dashboard{% endblock %}

{% block content %}
<h2>Assessor Dashboard</h2>
<p>Welcome, {{ request.user.first_name }} {{ request.user.last_name }} You have {{ assessment_count }} assessment(s) assigned.</p>


    <div class="mt-4">

</div>

 <div class="card mb-4">
    <div class="card-header">Data Management</div>
    <div class="card-body">

        <a href="{% url 'tracker:os_list' %}" class="btn btn-info">Manage Operating Systems</a>
        <a href="{% url 'tracker:upload_extract_report' %}" class="btn btn-success">
            <i class="fa-solid fa-file-arrow-up me-1"></i> Upload & Extract CE Report
        </a>
    </div>
     </div>

    <div class="col-md-4"> {# Or adjust layout #}
    <div class="card {% if pending_approval_count > 0 %}border-warning{% endif %}">
         <div class="card-header">Cloud Services</div>
         <div class="card-body">
            {% if pending_approval_count > 0 %}
                 <p class="card-text text-warning">
                     <i class="fa-solid fa-triangle-exclamation"></i>
                     {{ pending_approval_count }} service{{ pending_approval_count|pluralize }} pending approval.
                 </p>
            {% else %}
                 <p class="card-text text-success">
                     <i class="fa-solid fa-check-circle"></i>
                     All suggested services approved.
                 </p>
            {% endif %}
            <a href="{% url 'tracker:cloud_service_definition_list' %}" class="btn btn-primary btn-sm">Manage Definitions</a>
        </div>
    </div>
</div>


<h4 class="mt-4">My Assigned Assessments</h4>
{% if assessments %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Client</th>
                <th>Type</th>
                <th>Status</th>
                <th>Target End Date</th>
                <th>Outcome</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for assessment in assessments %}
            <tr>
                <td>{{ assessment.id }}</td>
                <td>{{ assessment.client.name }}</td>
                <td>{{ assessment.get_assessment_type_display }}</td>
                <td><span class="badge bg-info">{{ assessment.get_status_display }}</span></td>
                <td>{{ assessment.date_target_end|date:"Y-m-d"|default:"-" }}</td>
                 <td>
                    {% if assessment.final_outcome == 'Pass' %}
                        <span class="badge bg-success">{{ assessment.get_final_outcome_display }}</span>
                    {% elif assessment.final_outcome == 'Fail' %}
                         <span class="badge bg-danger">{{ assessment.get_final_outcome_display }}</span>
                    {% else %}
                         -
                    {% endif %}
                </td>
                <td class="action-buttons">
                    <a href="{% url 'tracker:assessor_assessment_detail' assessment.pk %}" class="btn btn-sm btn-outline-primary">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>



{% else %}
<p>You have no assessments currently assigned.</p>
{% endif %}


{% endblock %}