{% load i18n %}

<nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-white border-end collapse">
  <div class="position-sticky pt-3">

    <!-- Back Button -->
    <div class="px-3 mb-4">
      <a href="{% url 'tracker:client_assessment_list' %}"
         class="btn btn-outline-secondary btn-sm w-100">
        <i class="fas fa-arrow-left me-1"></i>
        {% translate "Back to My Assessments" %}
      </a>
    </div>

    <!-- MAIN NAVIGATION -->
    <ul class="nav flex-column px-3">
      <li class="nav-item mb-2">
        <span class="small text-uppercase text-muted">
          {% translate "On This Page" %}
        </span>
      </li>

      {% comment %} ========= Scope ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#nav-scope" role="button"
           aria-expanded="false" aria-controls="nav-scope">
          <span><i class="fas fa-sitemap me-2"></i>{% translate "Scope" %}</span>
          <span class="badge bg-primary">{{ scope_summary.total_items|default:"0" }}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-scope">
          <li class="nav-item">
            <a class="nav-link py-1" href="#scope-management-section">
              {% translate "View Summary" %}
            </a>
          </li>
          {% if can_edit_scope %}
          <li class="nav-item">
            <a class="nav-link py-1" href="{% url 'tracker:client_scope_manage' assessment.pk %}">
              <i class="fas fa-edit me-1"></i>{% translate "Manage Items" %}
            </a>
          </li>
          {% endif %}
        </ul>
      </li>

      {% comment %} ========= Networks ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#nav-networks" role="button"
           aria-expanded="false" aria-controls="nav-networks">
          <span><i class="fas fa-network-wired me-2"></i>{% translate "Networks" %}</span>
          <span class="badge bg-primary">{{ assessment.networks.count }}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-networks">
          <li class="nav-item">
            <a class="nav-link py-1" href="#networks-section">
              {% translate "View Details" %}
            </a>
          </li>
          {% if not assessment.status|slice:":8" == 'Complete' %}
          <li class="nav-item">
            <a class="nav-link py-1" href="{% url 'tracker:client_network_list' assessment.pk %}">
              <i class="fas fa-edit me-1"></i>{% translate "Manage Networks" %}
            </a>
          </li>
          {% endif %}
        </ul>
      </li>

      {% comment %} ========= Cloud Services ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#nav-cloud" role="button"
           aria-expanded="false" aria-controls="nav-cloud">
          <span><i class="fas fa-cloud me-2"></i>{% translate "Cloud Services" %}</span>
          <span class="badge bg-primary">{{ assessment.assessment_cloud_services.count }}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-cloud">
          <li class="nav-item">
            <a class="nav-link py-1" href="#cloud-services-section">
              {% translate "View Details" %}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-1" href="{% url 'tracker:client_assessment_cloud_service_list' assessment.pk %}">
              <i class="fas fa-edit me-1"></i>{% translate "Manage Services" %}
            </a>
          </li>
        </ul>
      </li>

      {% comment %} ========= External IPs ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#nav-ips" role="button"
           aria-expanded="false" aria-controls="nav-ips">
          <span><i class="fas fa-crosshairs me-2"></i>{% translate "External IPs" %}</span>
          <span class="badge bg-primary">{{ assessment.external_ips.count }}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-ips">
          <li class="nav-item">
            <a class="nav-link py-1" href="#external-ips-section">
              {% translate "View Details" %}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-1" href="{% url 'tracker:client_externalip_list' assessment.pk %}">
              <i class="fas fa-edit me-1"></i>{% translate "Manage Targets" %}
            </a>
          </li>
        </ul>
      </li>

      {% comment %} ========= Workflow ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex justify-content-between align-items-center"
           data-bs-toggle="collapse" href="#nav-workflow" role="button"
           aria-expanded="false" aria-controls="nav-workflow">
          <span><i class="fas fa-tasks me-2"></i>{% translate "Workflow" %}</span>
          <i class="fas fa-chevron-down small"></i>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-workflow">
          <li class="nav-item">
            <a class="nav-link py-1" href="#workflow-visual-section">{% translate "Visual" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-1" href="#workflow-checklist-section">{% translate "Checklist" %}</a>
          </li>
        </ul>
      </li>

      {% comment %} ========= CE+ Sample (optional) ========= {% endcomment %}
      {% if assessment.assessment_type == 'CE+' %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex align-items-center"
           data-bs-toggle="collapse" href="#nav-cesample" role="button"
           aria-expanded="false" aria-controls="nav-cesample">
          <span><i class="fas fa-vial me-2"></i>{% translate "CE+ Sample" %}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-cesample">
          <li class="nav-item">
            <a class="nav-link py-1" href="#ce-plus-sample-section">
              {% translate "View Details" %}
            </a>
          </li>
        </ul>
      </li>
      {% endif %}

      {% comment %} ========= Downloads ========= {% endcomment %}
      <li class="nav-item mb-1">
        <a class="nav-link d-flex align-items-center"
           data-bs-toggle="collapse" href="#nav-downloads" role="button"
           aria-expanded="false" aria-controls="nav-downloads">
          <span><i class="fas fa-download me-2"></i>{% translate "Downloads" %}</span>
        </a>
        <ul class="nav flex-column collapse ps-4" id="nav-downloads">
          <li class="nav-item">
            <a class="nav-link py-1" href="#downloads-section">
              {% translate "View Files" %}
            </a>
          </li>
        </ul>
      </li>
    </ul>

    <!-- OTHER ACTIONS -->
    <div class="mt-5 px-3">
      <span class="small text-uppercase text-muted">
        {% translate "Other Actions" %}
      </span>
      <ul class="nav flex-column mt-2">
        <li class="nav-item">
          <button type="button"
                  class="nav-link btn btn-link p-0 d-flex align-items-center"
                  data-bs-toggle="modal"
                  data-bs-target="#logModal">
            <i class="fas fa-history me-2"></i>
            {% translate "View Assessment Log" %}
          </button>
        </li>
      </ul>
    </div>

  </div>
</nav>